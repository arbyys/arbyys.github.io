import{d as O,u as R,e as P,s as _e,r as d,v as te,o as p,h as V,f as a,t as c,a as e,q as k,b as t,w as l,x as Q,y as M,c as T,n as se,m as j,F as U,i as W,z as ve,A as F,B as pe,C as me,D as z,P as ye,E as ge,G as K,H as he,_ as J,I as le,J as ne,K as oe,L as re,M as ue,N as G,O as ie,j as ae,Q as ce,S as H,R as de,T as be,U as Ie,V as xe,W as we,X as Te,Y as Ce,Z as $e,$ as X,a0 as ke,a1 as Se,a2 as Be,a3 as Ve,a4 as Qe,a5 as Ee,a6 as ze,a7 as De,a8 as Me,a9 as Ue,aa as Fe,ab as Le,ac as Ne,k as je,ad as Oe}from"./index-BrsgpGzm.js";import{b as Y,l as Re,c as fe,d as Z,e as ee}from"./Queries-BvASZ01y.js";const Pe={class:"text-light-tint ml-6"},Ae={class:"text-secondary"},qe={class:"mt-8"},Ge={class:"flex flex-col items-center"},He={class:"text-4xl font-bold mb-4 font-mono"},We={class:"mt-8 w-3/4 mx-auto"},Je={class:"text-secondary"},Ke={key:0,class:"ml-4 mt-5"},Xe={class:"font-medium"},Ye={class:"font-medium"},Ze={class:"ml-3 opacity-65 font-mono"},et={class:"mt-14"},tt={class:"flex gap-4 justify-center w-3/4 mx-auto"},lt={class:"flex flex-col text-left"},at={class:"text-xl"},st={class:"inline-flex items-center mt-1.5 opacity-70"},nt={class:"text-xs ml-2"},ot={class:"flex flex-col text-left"},rt={class:"text-xl"},ut={class:"inline-flex items-center mt-1.5 opacity-70"},it={class:"text-xs ml-2"},ct=O({__name:"CurrentInfusion",props:{currentInfusion:{}},setup(D){const{t:o}=R(),s=P.getEvolu(),m=D,{currentInfusion:u}=_e(m),r=d(),g=d(0),I=d(!1),h=d(null);s.subscribeQuery(Y(u.value.id))(()=>{const{rows:n}=s.getQuery(Y(u.value.id));r.value=n}),s.loadQuery(Y(u.value.id)).then(({rows:n})=>{r.value=n});const C=te(()=>b(g.value,!0)),w=n=>{(n.code==="Space"||n.key===" ")&&(n.preventDefault(),f())};window.addEventListener("keyup",w);const b=(n,i=!1)=>{const $=String(Math.floor(n/6e4)).padStart(2,"0"),x=String(Math.floor(n%6e4/1e3)).padStart(2,"0"),E=String(Math.floor(n%1e3/10)).padStart(2,"0");return i?`${$}:${x}:${E}`:`${$}:${x}`};function f(){I.value?S():L()}function L(){I.value=!0,h.value=setInterval(()=>{g.value+=10},10)}async function S(){I.value=!1,h.value!==null&&clearInterval(h.value);let n=0;await s.loadQuery(Re).then(({rows:i})=>{i.length&&i[0].order&&(n=i[0].order)}),s.create("_currentBrews",{currentInfusionId:u.value.id,order:z(ye)(n+1),length:z(ge)(g.value)}),g.value=0}const y=async()=>new Promise(async n=>{await(await he.create({header:"Confirm",message:o("confirm.question"),buttons:[{text:o("confirm.no"),role:"cancel",handler:()=>n(!1)},{text:o("confirm.yes"),handler:()=>n(!0)}]})).present()}),_=async()=>{var $;const n=($=u.value)==null?void 0:$.id;if(!n)return;s.update("_currentInfusion",{id:n,isDeleted:K(!0)});const i=await s.loadQuery(s.createQuery(x=>x.selectFrom("_currentBrews").where("currentInfusionId","is",n).select("id")));i&&i.rows&&i.rows.forEach(x=>{s.update("_currentBrews",{id:x.id,isDeleted:K(!0)})})},N=async()=>{var E;const n=(E=u.value)==null?void 0:E.id;if(!n||!await y()||!u.value||!u.value.tea_id)return;const{id:$}=s.create("infusions",{teaId:u.value.tea_id,endedAt:K(new Date)}),x=await s.loadQuery(s.createQuery(B=>B.selectFrom("_currentBrews").where("currentInfusionId","is",n).select(["id","length","order"])));x&&x.rows&&x.rows.forEach(B=>{!B.length||!B.order||s.create("brews",{infusionId:$,length:B.length,order:B.order})}),_()},v=async()=>{await y()&&_()};return(n,i)=>{var $,x,E,B;return p(),V(U,null,[a("h1",null,c(e(o)("current_infusion.heading")),1),a("h5",Pe,[k(c(e(o)("current_infusion.tea"))+" ",1),a("span",Ae,c(($=e(u))==null?void 0:$.tea_title)+" "+c((x=e(u))==null?void 0:x.tea_subtitle),1),k(" ("+c(e(o)(`tea_types.${(E=e(u))==null?void 0:E.tea_type_name}`))+") ",1)]),a("section",qe,[a("div",Ge,[a("div",He,c(C.value),1),t(e(Q),{onClick:f,expand:"full",size:"large",class:"w-40 mt-2"},{default:l(()=>[k(c(I.value?"Stop":"Start"),1)]),_:1})]),a("div",We,[a("h3",Je,c(e(o)("current_infusion.brews"))+":",1),(B=r.value)!=null&&B.length?M("",!0):(p(),V("div",Ke,c(e(o)("current_infusion.no_brews")),1)),t(e(ve),{inset:!0},{default:l(()=>{var A;return[(A=r.value)!=null&&A.length&&I.value?(p(),T(e(j),{key:0},{default:l(()=>[t(e(se),{class:"opacity-25"},{default:l(()=>[a("span",Xe,c(r.value.length+1)+". "+c(e(o)("current_infusion.brew"))+":",1),i[2]||(i[2]=a("span",{class:"ml-3 opacity-65 font-mono"},"??:??",-1))]),_:1})]),_:1})):M("",!0),(p(!0),V(U,null,W(r.value,(q,Qt)=>(p(),T(e(j),{key:q.id},{default:l(()=>[t(e(se),null,{default:l(()=>[a("span",Ye,c(q.order)+". "+c(e(o)("current_infusion.brew"))+":",1),a("span",Ze,c(q.length?b(q.length):"??:??"),1)]),_:2},1024)]),_:2},1024))),128))]}),_:1})])]),a("div",et,[a("div",tt,[t(e(Q),{fill:"outline",color:"danger",onClick:i[0]||(i[0]=A=>v()),class:"bg-[#1f0204] w-full"},{default:l(()=>[a("div",lt,[a("span",at,c(e(o)("current_infusion.cancel")),1),a("div",st,[t(e(F),{class:"size-5",slot:"start",icon:e(pe)},null,8,["icon"]),a("span",nt,c(e(o)("current_infusion.cancel_desc")),1)])])]),_:1}),t(e(Q),{onClick:i[1]||(i[1]=A=>N()),class:"flex items-center] w-full"},{default:l(()=>[a("div",ot,[a("span",rt,c(e(o)("current_infusion.save")),1),a("div",ut,[t(e(F),{class:"size-5",slot:"start",icon:e(me)},null,8,["icon"]),a("span",it,c(e(o)("current_infusion.save_desc")),1)])])]),_:1})])])],64)}}}),dt=J(ct,[["__scopeId","data-v-3a8ea438"]]),ft={class:"flex flex-col h-full"},_t={class:"flex-1"},vt={class:"mt-auto"},pt={class:""},mt=O({__name:"CreateTea",setup(D){const{t:o}=R(),s=d(),m=P.getEvolu(),u=d(),r=d(),g=d(),I=d();m.loadQuery(fe).then(({rows:w})=>{I.value=w});const h=()=>s.value.$el.dismiss(null,"cancel"),C=async()=>{!u.value||!g.value||(console.log(g.value),m.create("teas",{title:z(H)(u.value),subtitle:r.value?z(H)(r.value):null,teaTypeId:g.value.id}),h())};return(w,b)=>(p(),T(e(ce),{ref_key:"modal",ref:s,trigger:"open-create-tea",id:"create-tea-modal"},{default:l(()=>[t(e(ue),null,{default:l(()=>[t(e(le),null,{default:l(()=>[t(e(ne),{slot:"end"},{default:l(()=>[t(e(Q),{onClick:b[0]||(b[0]=f=>h())},{default:l(()=>[t(e(F),{icon:e(oe)},null,8,["icon"])]),_:1})]),_:1}),t(e(re),{color:"secondary"},{default:l(()=>[k(c(e(o)("create_tea.heading")),1)]),_:1})]),_:1})]),_:1}),t(e(ae),{class:"ion-padding"},{default:l(()=>[a("div",ft,[a("div",_t,[t(e(G),{class:"mt-3",label:e(o)("create_tea.title"),"label-placement":"floating",fill:"outline",placeholder:"Earl Grey",modelValue:u.value,"onUpdate:modelValue":b[1]||(b[1]=f=>u.value=f)},null,8,["label","modelValue"]),t(e(G),{class:"mt-6",label:e(o)("create_tea.subtitle"),"label-placement":"floating",fill:"outline",placeholder:"Ceylon",modelValue:r.value,"onUpdate:modelValue":b[2]||(b[2]=f=>r.value=f)},null,8,["label","modelValue"]),t(e(j),{class:"mt-6"},{default:l(()=>[t(e(ie),{justify:"start",color:"primary","aria-label":"teatype",label:e(o)("create_tea.tea_type"),placeholder:e(o)("create_tea.select"),interface:"popover",modelValue:g.value,"onUpdate:modelValue":b[3]||(b[3]=f=>g.value=f)},{default:l(()=>[(p(!0),V(U,null,W(I.value,f=>(p(),T(e(de),{value:f},{default:l(()=>[k(c(e(o)(`tea_types.${f.name}`)),1)]),_:2},1032,["value"]))),256))]),_:1},8,["label","placeholder","modelValue"])]),_:1})]),a("div",vt,[t(e(Q),{expand:"block",onClick:b[4]||(b[4]=f=>C()),class:"flex items-center mt-8"},{default:l(()=>[a("span",pt,c(e(o)("create_tea.submit")),1)]),_:1})])])]),_:1})]),_:1},512))}}),yt=J(mt,[["__scopeId","data-v-4505f762"]]),gt={class:"flex flex-col h-full"},ht={class:"flex-1"},bt={class:"mt-auto"},It={class:""},xt=O({__name:"EditTea",props:{editingId:{},selectedTitle:{},selectedSubtitle:{},selectedTeaType:{}},emits:["toggle"],setup(D,{emit:o}){const{t:s}=R(),m=d(),u=P.getEvolu(),r=D,g=o,I=d(r.editingId),h=d(r.selectedTitle);console.log("INStit",h.value);const C=d(r.selectedSubtitle),w=d(r.selectedTeaType),b=d();u.loadQuery(fe).then(({rows:S})=>{b.value=S});const f=()=>{m.value.$el.dismiss(null,"cancel")},L=async()=>{if(!h.value||!w.value)return;const S=d(),y=_=>u.createQuery(N=>N.selectFrom("teaTypes").where("name","is",z(be)(_)).selectAll());console.log("ga",w.value),await u.loadQuery(y(w.value)).then(({rows:_})=>{_.length&&_[0].id&&(S.value=_[0].id)}),S.value&&u.update("teas",{id:I.value,title:z(H)(h.value),subtitle:C.value?z(H)(C.value):null,teaTypeId:S.value}),f()};return(S,y)=>(p(),T(e(ce),{ref_key:"modal",ref:m,id:"edit-tea-modal",onWillDismiss:y[5]||(y[5]=_=>g("toggle"))},{default:l(()=>[t(e(ue),null,{default:l(()=>[t(e(le),null,{default:l(()=>[t(e(ne),{slot:"end"},{default:l(()=>[t(e(Q),{onClick:y[0]||(y[0]=_=>f())},{default:l(()=>[t(e(F),{icon:e(oe)},null,8,["icon"])]),_:1})]),_:1}),t(e(re),{color:"secondary"},{default:l(()=>[k(c(e(s)("edit_tea.heading")),1)]),_:1})]),_:1})]),_:1}),t(e(ae),{class:"ion-padding"},{default:l(()=>[a("div",gt,[a("div",ht,[t(e(G),{class:"mt-3",label:e(s)("create_tea.title"),"label-placement":"floating",fill:"outline",placeholder:e(s)("create_tea.title"),modelValue:h.value,"onUpdate:modelValue":y[1]||(y[1]=_=>h.value=_)},null,8,["label","placeholder","modelValue"]),t(e(G),{class:"mt-6",label:e(s)("create_tea.subtitle"),"label-placement":"floating",fill:"outline",placeholder:e(s)("create_tea.subtitle"),modelValue:C.value,"onUpdate:modelValue":y[2]||(y[2]=_=>C.value=_)},null,8,["label","placeholder","modelValue"]),t(e(j),{class:"mt-6"},{default:l(()=>[t(e(ie),{justify:"start",color:"primary","aria-label":"teatype",label:e(s)("create_tea.tea_type"),placeholder:"Select",interface:"popover",modelValue:w.value,"onUpdate:modelValue":y[3]||(y[3]=_=>w.value=_)},{default:l(()=>[(p(!0),V(U,null,W(b.value,_=>(p(),T(e(de),{value:_.name},{default:l(()=>[k(c(e(s)(`tea_types.${_.name}`)),1)]),_:2},1032,["value"]))),256))]),_:1},8,["label","modelValue"])]),_:1})]),a("div",bt,[t(e(Q),{expand:"block",onClick:y[4]||(y[4]=_=>L()),class:"flex items-center mt-8"},{default:l(()=>[a("span",It,c(e(s)("edit_tea.submit")),1)]),_:1})])])]),_:1})]),_:1},512))}}),wt=J(xt,[["__scopeId","data-v-de439a95"]]),Tt={key:0,class:"absolute z-50 w-full h-full bg-gray-800 bg-opacity-40 text-gray-400 text-xl uppercase flex items-center justify-center"},Ct={class:"flex justify-center items-center w-full h-1/6 bg-gray-700 bg-opacity-70 py-5"},$t={class:"edit-btn absolute top-1 right-1 z-50"},kt=O({__name:"SelectTea",setup(D,{expose:o}){const{t:s}=R(),m=d([]),u=d(""),r=P.getEvolu(),g=d(),I=d(),h=d(),C=d(),w=d();r.subscribeQuery(Z)(()=>{const{rows:v}=r.getQuery(Z);m.value=v}),o({refreshTeas:()=>{r.loadQuery(Z).then(({rows:v})=>{m.value=v})}});const f=d(),L=v=>{u.value=v.target.value.toLowerCase().trim()},S=async()=>{f.value&&r.create("_currentInfusion",{teaId:f.value})},y=te(()=>u?m.value.filter(v=>v.title&&v.title.toLowerCase().indexOf(u.value)>-1):m.value),_=()=>{g.value=!g.value},N=async v=>{console.log(v),!(!v||!v.id||!v.tea_title||!v.tea_type_name)&&(I.value=v.tea_id,h.value=v.tea_title,C.value=v.tea_subtitle??void 0,w.value=v.tea_type_name,console.log("tit",h.value),_())};return(v,n)=>(p(),V(U,null,[a("h1",null,c(e(s)("select_tea.heading")),1),t(e(j),{class:"pt-5"},{default:l(()=>[t(e(Ie),{placeholder:e(s)("select_tea.search"),class:"pr-8 lg:pr-10","show-clear-button":"always",debounce:250,onIonInput:n[0]||(n[0]=i=>L(i))},null,8,["placeholder"]),t(e(xe),{horizontal:"end"},{default:l(()=>[t(e(we),{size:"small",color:"secondary",class:"mr-[-5px]",id:"open-create-tea"},{default:l(()=>[t(e(F),{icon:e(Te)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),t(e($e),{fixed:!0,class:"mt-3"},{default:l(()=>[t(e(Ce),null,{default:l(()=>[(p(!0),V(U,null,W(y.value,(i,$)=>(p(),T(e(ke),{size:"12","size-sm":"6","size-lg":"4"},{default:l(()=>[t(e(Se),{class:Be(["tea-card relative bg-[#1f1f1f] border border-[#2f2f2f] min-h-40 flex flex-wrap content-between rounded-xl rounded-b-2xl transition-transform hover:scale-105 hover:cursor-pointer",{"border-2 border-gray-700":i.tea_id==f.value}]),onClick:x=>f.value=i.tea_id==f.value?void 0:i.tea_id},{default:l(()=>[t(X,null,{default:l(()=>[i.tea_id==f.value?(p(),V("div",Tt,[a("div",Ct,c(e(s)("select_tea.selected")),1)])):M("",!0)]),_:2},1024),t(X,null,{default:l(()=>[a("div",$t,[t(e(Q),{size:"small",color:"secondary",onClick:Ve(x=>N(i),["stop"]),id:"open-edit-tea"},{default:l(()=>[t(e(F),{icon:e(Qe)},null,8,["icon"])]),_:2},1032,["onClick"])])]),_:2},1024),t(e(Ee),{class:"w-full bg-dark min-h-20"},{default:l(()=>[t(e(ze),{color:"primary"},{default:l(()=>[k(c(i.tea_title),1)]),_:2},1024),t(e(De),{class:"opacity-60 text-primary-shade"},{default:l(()=>[k(c(i.tea_subtitle??"–"),1)]),_:2},1024)]),_:2},1024),t(e(Me),{class:"w-full mb-1 text-gray-500"},{default:l(()=>[k(c(e(s)(`tea_types.${i.tea_type_name}`)),1)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),256))]),_:1})]),_:1}),t(yt),I.value&&h.value&&w.value?(p(),T(wt,{key:I.value,"is-open":g.value,onToggle:_,"editing-id":I.value,"selected-title":h.value,"selected-subtitle":C.value,"selected-tea-type":w.value},null,8,["is-open","editing-id","selected-title","selected-subtitle","selected-tea-type"])):M("",!0),t(X,null,{default:l(()=>[f.value?(p(),T(e(Q),{key:0,size:"large",class:"fixed bottom-2 right-2 sm:bottom-4 sm:right-4 lg:bottom-4 lg:right-8",onClick:S},{default:l(()=>n[1]||(n[1]=[k(" Begin infusion ")])),_:1})):M("",!0)]),_:1})],64))}}),St=J(kt,[["__scopeId","data-v-14cbd772"]]),Bt={id:"main",class:"pb-4"},Vt={key:0,class:"text-center mt-8"},Dt=O({__name:"Infusion",setup(D){R();const o=d(),s=P.getEvolu(),m=d(),u=te(()=>{var r;return!!((r=m.value)!=null&&r.length)});return Ue(u,async r=>{await Oe(),o.value&&o.value.refreshTeas()},{immediate:!0,deep:!0}),s.loadQuery(ee).then(({rows:r})=>{m.value=r}),s.subscribeQuery(ee)(()=>{const{rows:r}=s.getQuery(ee);m.value=r}),(r,g)=>(p(),T(e(je),null,{default:l(()=>[t(e(le)),t(e(ae),{class:"ion-padding"},{default:l(()=>[a("main",Bt,[m.value?M("",!0):(p(),V("div",Vt,[t(e(Fe),{name:"dots",class:"size-28"})])),Le(a("div",null,[m.value&&u.value?(p(),T(dt,{key:0,currentInfusion:m.value[0]},null,8,["currentInfusion"])):(p(),T(St,{key:1,ref_key:"selectTeaRef",ref:o},null,512))],512),[[Ne,!!m.value]])])]),_:1})]),_:1}))}});export{Dt as default};
